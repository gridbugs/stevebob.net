function mountain_reset(){mountain_ctx.clearRect(0,0,WIDTH,HEIGHT),peaks=[],mountains=[],generate_mountains(),array_shuffle(mountains);for(var e in mountains){for(var t=0;t<DETAIL_LEVEL;t++)mountains[e].add_detail();mountains[e].set_snow_pts(),mountains[e].fill(),mountains[e].draw_lines(),mountains[e].fill_snow()}}function mountain_main(){init(),mountain_reset()}function MountainPoint(e,t){this.x=e,this.y=t,this.dot=function(){dot(this.x,this.y)}}function MountainLine(e,t){this.p0=e,this.p1=t,this.midpoint=function(){var n=t.x-e.x,r=t.y-e.y;return new MountainPoint(e.x+n/2,e.y+r/2)},this.near_midpoint=function(){var e=this.midpoint(),t=this.length()/100,n=Math.random()*Math.PI*2,r=Math.random()*DETAIL_VARIANCE*t,i=Math.cos(n)*r,s=Math.sin(n)*r;return new MountainPoint(e.x+i,e.y+s)},this.draw=function(){mountain_ctx.strokeStyle="rgb(130, 60, 180)",mountain_ctx.fillStyle="rgb(190, 120, 240)",mountain_ctx.lineWidth=2,mountain_ctx.beginPath(),mountain_ctx.moveTo(e.x,e.y),mountain_ctx.lineTo(t.x,t.y),mountain_ctx.stroke()},this.length=function(){var e=this.p0.x-this.p1.x,t=this.p0.y-this.p1.y;return Math.sqrt(e*e+t*t)}}function LineList(){this.first=null,this.push=function(e){if(this.first==null)this.first=new LineLink(e,null);else{var t=new LineLink(e,this.first);this.first=t}},this.draw_all=function(){var e=this.first;while(e!=null)e.line.draw(),e=e.next},this.split_all=function(){var e=this.first;while(e!=null){var t=e.line.near_midpoint(),n=new MountainLine(e.line.p0,t),r=new MountainLine(t,e.line.p1),i=new LineLink(r,e.next);e.line=n,e.next=i,e=i.next}}}function LineLink(e,t){this.line=e,this.next=t}function Mountain(e,t,n){this.peak=e,this.left=t,this.right=n;var r=HEIGHT-(Math.random()*(SNOW_MAX-SNOW_MIN)+SNOW_MIN),i=[],s=new LineList;s.push(new MountainLine(this.peak,this.right)),s.push(new MountainLine(this.left,this.peak)),this.draw_lines=function(){s.draw_all()},this.fill=function(){var e=s.first;mountain_ctx.fillStyle="rgb(190, 120, 240)",mountain_ctx.beginPath(),mountain_ctx.moveTo(e.line.p0.x,e.line.p0.y);while(e!=null)mountain_ctx.lineTo(parseInt(e.line.p1.x),parseInt(e.line.p1.y)),e=e.next;mountain_ctx.fill(),mountain_ctx.closePath()},this.add_detail=function(){s.split_all()},this.set_snow_pts=function(){var e=s.first,t=!1,n=!1,o,u;while(e!=null){if(e.line.p0.y<=r&&e.line.p1.y>=r){o=e.line.midpoint();var a=new MountainLine(e.line.p0,o);i.push(a),t=!0;break}if(e.line.p0.y>=r&&e.line.p1.y<=r){u=e.line.midpoint();var a=new MountainLine(u,e.line.p1);i.push(a),n=!0,e=e.next;continue}n&&i.push(e.line),e=e.next}if(t){var f=new LineList;f.push(new MountainLine(o,u));for(var l=0;l<SNOW_DETAIL_LEVEL;l++)f.split_all();e=f.first;while(e!=null)i.push(e.line),e=e.next}},this.fill_snow=function(){if(i.length==0)return;mountain_ctx.fillStyle="rgb(255, 255, 255)",mountain_ctx.beginPath(),mountain_ctx.moveTo(i[0].p0.x,i[0].p0.y);for(var e in i)mountain_ctx.lineTo(i[e].p1.x,i[e].p1.y);mountain_ctx.strokeStyle="rgb(200, 200, 200)",mountain_ctx.lineWidth=2,mountain_ctx.fill(),mountain_ctx.stroke(),mountain_ctx.closePath()},this.get_snow_lines=function(){return i}}function get_mountain(e){var t=e.y-e.x,n=HEIGHT-t,r=new MountainPoint(n,HEIGHT),i=new MountainPoint(n-2*(n-e.x),HEIGHT);return new Mountain(e,r,i)}function distance(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function init(){var e=document.getElementById("mountain");e.getContext&&(mountain_ctx=e.getContext("2d"))}function dot(e,t){mountain_ctx.fillRect(e-5,t-5,10,10),mountain_ctx.fill()}function generate_mountains(){generate_peaks();for(var e in peaks)mountains.push(get_mountain(peaks[e]))}function generate_peaks(){var e=HEIGHT;while(e<WIDTH)e+=Math.random()*(PEAK_MAX_SPREAD-PEAK_MIN_SPREAD)+PEAK_MIN_SPREAD,y=Math.random()*HEIGHT/2,peaks.push(new MountainPoint(e,y))}function array_shuffle(e){for(var t in e){var n=parseInt(Math.random()*e.length),r=e[t];e[t]=e[n],e[n]=r}}var mountain_ctx,peaks=[],mountains=[];const WIDTH=600,HEIGHT=130,ATTEMPTS=20,PEAK_MAX_SPREAD=100,PEAK_MIN_SPREAD=50,PEAK_COUNT=5,DETAIL_LEVEL=8,DETAIL_VARIANCE=8,SNOW_MIN=50,SNOW_MAX=120,SNOW_DETAIL_LEVEL=8;