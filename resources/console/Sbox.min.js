function Sbox(){function s(s,u){this.token=s,this.value=u,this.next=[],this.evaluate=function(){if(this.token==Sbox.DO){var s=null;for(var u=0;u<this.next.length;u++)s=this.next[u].evaluate();return s}if(this.token==Sbox.LIST){var a=[];for(var u in this.next)a[u]=this.next[u].evaluate();return a}if(this.token==Sbox.FNASSIGN)return o(Sbox.FNASSIGN,this.next);if(this.token==Sbox.LOOP){var f=!0;while(f)f=this.next[0].evaluate(),f&&this.next[1].evaluate();return null}if(this.token==Sbox.IF){var l=this.next[0].evaluate();return l?this.next[1].evaluate():this.next[2].evaluate()}if(this.next.length==0)return this.token==Sbox.UNASSIGNED?(e.write("Insufficient arguments supplied to "+this.token),i=!0,null):this.token==Sbox.LITERAL?this.value:this.token==Sbox.VARIABLE?t[this.value]!=undefined?t[this.value]:(e.write(this.value+" is undefined."),i=!0,null):n[this.token]!=undefined||r[this.token]!=undefined?o(this.token):(e.write("No such function "+this.token),i=!0,null);var c=[];for(var u=0;u<this.next.length;u++){c[u]=this.next[u].evaluate();if(c[u]==null)return i||(e.write("Expected expression - null received"),i=!0),null}return o(this.token,c)},this.addArg=function(e){this.next[this.next.length]=e}}function o(t,o){if(r[t]!=undefined)return r[t](o);if(n[t]!=undefined){var u=n[t],a=[];a[0]=new s(u.token,u.value),a[0].argIndex=u.argIndex;var f=a[0],l=[];l[0]=u;var c=1;while(c>0){c--;var t=a[c].token;if(t==Sbox.UNASSIGNED){var h=a[c].value;o[h]!=undefined&&(a[c].token=Sbox.LITERAL,a[c].value=o[h])}var p=l[c],d=a[c];for(var v=p.next.length-1;v>=0;v--)l[c]=p.next[v],a[c]=new s(l[c].token,l[c].value),d.next[v]=a[c],c++}return f.evaluate()}return i=!0,e.write(t+" is undefined."),null}function u(e){if(e=="")return"";var t=0,n=0;while(e[t]!=" "&&t<e.length)t++;n=t;while(e[t]==" "&&t<e.length)t++;return e.substring(0,n)+u(e.substring(t,e.length))}function a(e){this.value=e}function f(t){var n="",r=0;if(t.value[r]==")")return t.value=t.value.substring(1,t.value.length),null;if(t.value[r]==":"){r++,n="";while(l(t.value[r]))n+=t.value[r],r++;return t.value[r]==","&&r++,t.value=t.value.substring(r,t.value.length),new s(Sbox.UNASSIGNED,parseInt(n))}if(l(t.value[r])||t.value[r]=="-"){n="";var o=0,u=r;while(l(t.value[r])||t.value[r]=="."&&o==0||t.value[r]=="-"&&r==u)n+=t.value[r],r++;return t.value[r]==","&&r++,t.value=t.value.substring(r,t.value.length),new s(Sbox.LITERAL,parseFloat(n))}if(t.value[r]=='"'){n="",r++;while(t.value[r]!='"')n+=t.value[r],r++;return r++,t.value[r]==","&&r++,t.value=t.value.substring(r,t.value.length),new s(Sbox.LITERAL,n)}if(!(r<t.value.length&&c(t.value[r])))return e.write("Parse error - unexpected token: "+t.value[0]),i=!0,null;n="";while(r<t.value.length&&c(t.value[r]))n+=t.value[r],r++;if(r==t.value.length||h(t.value[r]))return t.value[r]==","&&r++,t.value=t.value.substring(r,t.value.length),new s(Sbox.VARIABLE,n);if(t.value[r]=="("){var a;Sbox.TOKEN[n]==undefined?a=new s(n):a=new s(Sbox.TOKEN[n]),r++,t.value=t.value.substring(r,t.value.length);var p=!1,d=0;while(!p){var v=f(t);v==null?p=!0:(a.next[d]=v,d++)}return t.value[0]==","&&(t.value=t.value.substring(1,t.value.length)),a}}function l(e){var t=parseInt(e);return 0<=t&&t<=9}function c(e){return e.match(/[a-zA-Z]/)}function h(e){return e==")"||e==","}function p(e){var t=e,n;while(n=t.match(/([a-zA-Z]+)=(.+)/)){var r=n[1],i=n[2],s=d(i),o=new RegExp(r+"="+s,"g");e=e.replace(o,'assign("'+r+'",'+s+")"),t=i.substring(s.length)}var u=e.match(/^([a-zA-Z]+)\((.*)\)=(.+)/);if(u!=null){var r=u[1],a=u[2],f=u[3],t=a,l=0;while(t!=""){var c=0,h="";while(c<t.length&&t[c]!=",")h+=t[c],c++;t=t.substring(c+1,t.length);var o=new RegExp(h+"([,)])","g");f=f.replace(o,":"+l+"$1");var o=new RegExp("^"+h+"$");f=f.replace(o,":"+l),l++}e='fnassign("'+r+'",'+f+")"}return e}function d(e){var t="",n=0;while(n<e.length&&e[n]!="("&&e[n]!=")"&&e[n]!=",")t+=e[n],n++;if(e[n]=="("){var r=1;while(r!=0&&n<e.length)t+=e[n],e[n]=="("?r++:e[n]==")"&&r--,n++}return t}var e,t=[],n=[],r=[],i;r.add=function(e){return e[0]+e[1]},r.gt=function(e){return e[0]>e[1]},r.multiply=function(e){return e[0]*e[1]},r.lt=function(e){return e[0]<e[1]},r.ge=function(e){return e[0]>=e[1]},r.le=function(e){return e[0]<=e[1]},r.or=function(e){return e[0]||e[1]},r.and=function(e){return e[0]&&e[1]},r.minus=function(e){return e[0]-e[1]},r.divide=function(e){return e[0]/e[1]},r.not=function(e){return!e[0]},r.id=function(e){return e[0]},r.append=function(e){var t=[];for(var n in e[0])t[n]=e[0][n];return t[t.length]=e[1],t},r[Sbox.ASSIGN]=function(e){return t[e[0]]=e[1],null},r[Sbox.FNASSIGN]=function(e){return n[e[0].value]=e[1],null},r.print=function(t){return e.append(t[0]),null},r.println=function(t){return e.write(t[0]),null},r.url=function(e){return document.location=e[0],null},this.connectConsole=function(t){e=t},this.evaluate=function(e){i=!1;if(e=="")return null;var t=new a(u(e)),n=new a(p(t.value)),r=f(n);return r==null?null:r.evaluate()},this.addFunction=function(e,t){r[e]=t}}Sbox.TOKEN=[],Sbox.LITERAL=0,Sbox.VARIABLE=1,Sbox.UNASSIGNED=2,Sbox.LOOP=30,Sbox.DO=31,Sbox.ASSIGN=32,Sbox.FNASSIGN=33,Sbox.IF=34,Sbox.LIST=35,Sbox.TOKEN.loop=Sbox.LOOP,Sbox.TOKEN["do"]=Sbox.DO,Sbox.TOKEN["if"]=Sbox.IF,Sbox.TOKEN.assign=Sbox.ASSIGN,Sbox.TOKEN.fnassign=Sbox.FNASSIGN,Sbox.TOKEN.list=Sbox.LIST;