<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="http://staging.stevebob.net/sb.css">
<link rel="stylesheet" type="text/css" href="http://staging.stevebob.net/syntax.min.css">
<script src="http://staging.stevebob.net/tree.min.js" type="text/javascript"></script>
<script src="http://staging.stevebob.net/mountain.min.js" type="text/javascript"></script>
<script src="http://staging.stevebob.net/jquery.min.js" type="text/javascript"></script>

<script type="text/javascript" src="http://staging.stevebob.net/console/Console.min.js"></script>
<script type="text/javascript" src="http://staging.stevebob.net/console/SBConsole.min.js"></script>
<script type="text/javascript" src="http://staging.stevebob.net/console/consoleClient.min.js"></script>
<script type="text/javascript" src="http://staging.stevebob.net/console/Sbox.min.js"></script>
<script type="text/javascript" src="http://staging.stevebob.net/console/Interpreter.min.js"></script>

<title>stevebob.net...Reinventing the 3D Wheel</title>
<link rel="icon" type="image/png" href="http://stevebob.net/favicon.png">
</head>
<body onload="new TreeDemo().start_tree();mountain_main();initConsole()">


<div id="tree">
<div id="treeclick" onclick="new TreeDemo().start_tree()">
</div>
<canvas id="screen" width=300 height=200 style="position:absolute;left:-30px;z-index:2"></canvas>
</div>

<div id="mountain_container">

<div id="mountain_click" onclick="mountain_reset()"></div>
<canvas id="mountain" height=130 width=500>
</canvas>

</div>


<div id="sky">
</div>
<div id="skymain">
<div id="skycontent">

                <input id="consoleinput"
                />
            <div id="consoleoutput">
                <p style="font-size:30px;margin:0px;">
                <br />
                </p>
                <p style="font-size:40px">stevebob.net...</p>
            </div>

            
</div>
</div>

 




<div id="linkbar">

<div id="linkbarmain">

<div id="linkbarcontents">
<ul class="links">

<div class="selectedBannerLinkContainer">

<li>
<a href="http://staging.stevebob.net/">
<div class="bannerlink">
Home</div>
</a>
</li>
</div>

<div class="bannerlinkcontainer">

<li>
<a href="http://staging.stevebob.net/about">
<div class="bannerlink">
About</div>
</a>
</li>
</div>

<div class="bannerlinkcontainer">

<li>
<a href="http://staging.stevebob.net/apps">
<div class="bannerlink">
Apps</div>
</a>
</li>

<div class="dropMenu">
<div class="dropMenuContainee" style="width: 700px">

<ul class="links">


<div class="app-column">
    <li><a class="menuLink" href="http://staging.stevebob.net/3dhero">3D Hero</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/3dtesla">3D Tesla</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/4dhero">4D Hero</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/bsp">BSP Demo</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/bsp-wireframe">BSP Wireframe</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/backface-culling">Backface Culling</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/backface-culling-2-cubes">Backface Culling 2 Cubes</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/boxillusion">Box Illusion</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/button">Button</a></li>
    <li><a class="menuLink" href="http://comp1917.ripenetwork.com">COMP1917 in a Day</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/cell">Cell</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/clipping-plane">Clipping Plane</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/convexhull-demo">Convex Hull Demo</a></li>
</div>

<div class="app-column">
    <li><a class="menuLink" href="http://staging.stevebob.net/dots">Dots</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/fractal">Fractal</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/fractalcubes">Fractal Cubes</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/fractbox">Fractbox</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/grav">Grav</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/heart">Heart</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/hero">Hero</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/herojs1k">Hero JS1K2014</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/hyperspace">Hyperspace</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/iou">IOU</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/isometric_demo">Isometric Demo</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/jewels">Jewels</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/lex">Lex</a></li>
</div>

<div class="app-column">
    <li><a class="menuLink" href="http://staging.stevebob.net/lowres">Lowres</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/mandelbrot">Mandelbrot</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/matrix">Matrix</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/merry">Merry</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/message">Message</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/metashape">Metashape</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/pixbox">Pixbox</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/pixtree">Pixtree</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/rpg">RPG</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/rave">Rave</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/rave_legacy">Rave Legacy</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/ray">Ray</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/raycastdemo">Ray Cast Demo</a></li>
</div>

<div class="app-column">
    <li><a class="menuLink" href="http://rsc.stevebob.net">Really Simple Chat</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/rooms">Rooms</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/shadows">Shadows</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/snow">Snow</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/storm">Storm</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/tesla">Tesla</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/tesseract">Tesseract</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/three">Three</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/tree">Tree</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/vines">Vines</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/wireframe">Wireframe</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/worms">Worms</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/xor">XOR</a></li>
</div>

</ul>

</div>
</div>
</div>


<div class="bannerlinkcontainer">

<li>
<a href="http://staging.stevebob.net/posts">
<div class="bannerlink">
Posts
</div>
</a>
</li>

<div class="dropMenu">
<div class="dropMenuContainee" style="width: 400px">

<ul class="links">

<div class="post-column">
    <li><a class="menuLink" href="http://staging.stevebob.net/reinventing-the-3d-wheel">Reinventing the 3D Wheel</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/heroes-and-villains">Heroes and Villains</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/dont-plan-your-trip">Don't Plan Your Trip</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/confusing-train-adventure">Confusing Train Adventure</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/thinking-fourth-dimensionally">Thinking Fourth Dimensionally</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/agda-environment">Agda Programming Environment</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/framebuffers-and-coffee">Framebuffers and Coffee</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/all-grown-up">All Grown Up</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/rpg_engine_bsp_tree_insertion">RPG Engine: BSP Tree Insertion</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/rpg_engine_intro">RPG Engine: Introduction</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/existentialcrisis">Existential Crisis</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/nyak">New York, Alaska</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/tmo">Toronto, Montreal, Ottawa</a></li>
</div>

<div class="post-column">
    <li><a class="menuLink" href="http://staging.stevebob.net/photos1">Exchange: Photos 1</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/exchange_canada">Exchange: Canada</a></li>
    <li><a class="menuLink" href="http://staging.stevebob.net/blog-written-in-perl">This Blog is Written in Perl</a></li>
</div>
</ul>



</div>
</div>


</div>

</ul>


</div>

</div>















</div>

<div id="main">


<div id="leftmain">
<div id="leftlinks" class="sidepane">
<ul class="links">
<li><a class="leftlink" href="http://staging.stevebob.net/3dhero">3D Hero</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/3dtesla">3D Tesla</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/4dhero">4D Hero</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/bsp">BSP Demo</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/bsp-wireframe">BSP Wireframe</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/button">Button</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/fractalcubes">Fractal Cubes</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/fractbox">Fractbox</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/heart">Heart</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/hero">Hero</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/herojs1k">Hero JS1K2014</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/hyperspace">Hyperspace</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/iou">IOU</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/isometric_demo">Isometric Demo</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/lex">Lex</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/lowres">Lowres</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/mandelbrot">Mandelbrot</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/metashape">Metashape</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/pixtree">Pixtree</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/rpg">RPG</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/rave_legacy">Rave Legacy</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/rooms">Rooms</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/shadows">Shadows</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/snow">Snow</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/tesla">Tesla</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/tesseract">Tesseract</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/three">Three</a></li>
<li><a class="leftlink" href="http://staging.stevebob.net/tree">Tree</a></li>
</ul>
</div>
</div>

<div id="rightmain">

<div id="contact-box">

<a href="https://github.com/stevebob"><img src="http://staging.stevebob.net/github.png" alt="Github"></a>
<a href="http://stevebob.net/rss.xml"><img src="http://staging.stevebob.net/rss.png" alt="RSS Feed"></a>
<a href="mailto:stephen@sherra.tt"><img src="http://staging.stevebob.net/email.png" alt="Email"></a>
<a href="https://www.facebook.com/stephen.sherratt1"><img src="http://staging.stevebob.net/facebook.png" alt="Facebook"></a>

</div>

<div id="rightlinks" class="sidepane">
<ul class="links">
<li><a class="right_link" href="http://staging.stevebob.net/reinventing-the-3d-wheel">Reinventing the 3D Wheel</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/heroes-and-villains">Heroes and Villains</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/dont-plan-your-trip">Don't Plan Your Trip</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/confusing-train-adventure">Confusing Train Adventure</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/thinking-fourth-dimensionally">Thinking Fourth Dimensionally</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/agda-environment">Agda Programming Environment</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/framebuffers-and-coffee">Framebuffers and Coffee</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/all-grown-up">All Grown Up</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/rpg_engine_bsp_tree_insertion">RPG Engine: BSP Tree Insertion</a></li>
<li><a class="right_link" href="http://staging.stevebob.net/rpg_engine_intro">RPG Engine: Introduction</a></li>
</ul>
</div>


<div id="career" class="sidepane">
<ul class="links">
<li><a class="right_link" href="http://stephen.sherra.tt">Resume (html)</a></li>
<li><a class="right_link" href="/resume/StephenSherrattResume.pdf">Resume (pdf)</a></li>
</ul>
</div>

</div>



<div id="centremain">
<div id="centrecontent">


<div class="post-container">
<div class="heading-container">
<h1>Reinventing the 3D Wheel</h1>
<div class="under-heading">
2014-08-12 23:00
</div>
</div>
<div class="post-body">

<p>This is an explanation of the 3D drawing techniques that have been used on this site. During the life of this site I have implemented and re-implemented linear algebra libraries and 3D demos which used them.</p>

<p>Here are some demos that make use of 3D:</p>

<ul>
<li><a href="/bsp">BSP demo</a></li>

<li><a href="/tesseract">Tesseract</a></li>

<li><a href="/3dtesla">3D Tesla</a></li>

<li><a href="/fractalcubes">Fractal Cubes</a></li>

<li><a href="/rooms">Rooms</a></li>
</ul>

<h2 id="doing_everything_from_scratch">Doing everything from scratch</h2>

<p>When I started writing demos for this site I had an aversion to using any third party libraries. I wanted to learn how everything worked and that meant shunning existing technology in favour of writing everything myself from scratch. Many of the demos on this site are 3D but none make use of <a href="http://en.wikipedia.org/wiki/WebGL">WebGL</a>, <a href="http://threejs.org/">three.js</a> or any other well established 3D web technology. All the demos use a 2D HTML canvas context, with all the maths to make images appear 3D implemented in javascript.</p>

<h2 id="high_school_technical_drawing">High School Technical Drawing</h2>

<p>My first attempt at a 3D engine was based very closely on a technique I learnt in my high school graphics class. This class focussed on technical drawing both by hand on paper and using CAD software. We learnt how to do perspective projection on paper in the following way:</p>

</div>
<div class="post-image-centre-container">

<table class="image-centre">
<caption class="image-caption">Perspective projection I learnt in high school
</caption>
<tr><td>
<img class="post-image-centre" src="http://staging.stevebob.net/reinventing-the-3d-wheel/hs-graphics.png" title="highschool graphics"  alt="highschool graphics"  align="centre"  width="100%" />
</td></tr>
</table>

</div>

<div class="post-body">

<p>Here’s how to hand draw a wireframe cube using perspective projection as per the diagram above:</p>
<style>
div.instruction-container {
    position:relative;
    padding-left:1.4em;
}
div.instruction-container div {
    position:absolute;
    top:0px;left:0px;
    width:1em;height:1em;
}
</style><div class="instruction-container"><div style="background-color:red"> </div>
Start by drawing lines from each point of the top view to the eye.
</div><div class="instruction-container"><div style="background-color:blue"> </div>
From the point where each of these lines crosses the horizon, draw a line straight
down until it intersects the picture plane.
</div><div class="instruction-container"><div style="background-color:lime"> </div>
From each point in the top view, draw a line straight down until it intersects the
picture plane, then begin a new line from that point to the vanishing point.
</div><div class="instruction-container"><div style="background-color:orange"> </div>
For each point in the top view with a height (position on the up/down axis) of 0,
it's position in the perspective projection is the intersection of its corresponding
<span style="color:lime">green</span> and <span style="color:blue">blue</span> lines.
</div><div class="instruction-container"><div style="background-color:cyan"> </div>
For each point in the front view (besides the ones with 0 height), draw a horizontal 
line through that point which intersects all <span style="color:lime">green</span> 
lines. From each intersection of a line from a point on the front view with 
a <span style="color:lime">green</span> line from a corresponding point in the top view,
draw a line from the intersection point to the vanishing point.
</div><div class="instruction-container"><div style="background-color:magenta"> </div>
The intersections of the <span style="color:cyan">cyan</span> lines with
the corresponding <span style="color:blue">blue</span> lines are the positions
of the corresponding points in the perspective projection.
</div>
<p>Now that the points are all present, draw lines between the ones between which edges exist in the shape you’re trying to draw.</p>

<h2 id="automating_the_process">Automating the process</h2>

<p>As I knew how to draw perspective projections of shapes by hand, the next step was to write a program to draw shapes using the same technique. I actually wrote a <a href="http://en.wikipedia.org/wiki/QBasic">QBasic</a> program to do this for flat objects (where all points have 0 height) while in my “experimenting with MS-DOS” phase in high school, and then re-implemented it in javascript for non-flat objects based on the same maths a year or so later.</p>

<p>For a computer to be able to draw perspective projections, it needs a way to compute the 2D coordinates for drawing on the screen, from a given point specified using 3D coordinates. Repeatedly doing this for each point of a 3D object, and drawing lines between the corresponding points on the screen, results in its perspective projection.</p>


<table class="image-left">
<caption class="image-caption">Basic idea of similar triangles
</caption>
<tr><td>
<img class="post-image-left" src="http://staging.stevebob.net/reinventing-the-3d-wheel/similar-triangles.png" title="similar triangles"  alt="similar triangles"  align="left"  width="150" />
</td></tr>
</table>



<p>So how to convert a 3D point into a 2D point which can be drawn on a screen? My solution used Similar Triangles As shown in the diagram on the left, if you have 2 right-angle triangles with the same ratio of side lengths, and you know the side lengths of one of them, and the length of one of the sides of the other, the length of the remaining side can be derived.</p>

<p>The perspective projection above is full of triangles, so all I needed to do was find some triangles to help compute the 2D point on the perspective projection from the information known about the point.</p>

<p>Below is the triangle used for finding the horizontal point (called ‘a’ in the diagram).</p>

</div>
<div class="post-image-centre-container">

<table class="image-centre">
<caption class="image-caption">Method for finding the horizontal position of a 2D point in a perspective projection
</caption>
<tr><td>
<img class="post-image-centre" src="http://staging.stevebob.net/reinventing-the-3d-wheel/similar-triangles-a.png" title="horizontal triangle"  alt="horizontal triangle"  align="centre"  width="600px" />
</td></tr>
</table>

</div>

<div class="post-body">

<p>Once the horizontal position of the point is known, it can be used to compute the vertical position (referred to here as ‘b’) in a similar way:</p>

</div>
<div class="post-image-centre-container">

<table class="image-centre">
<caption class="image-caption">Method for finding the vertical position of a 2D point in a perspective projection
</caption>
<tr><td>
<img class="post-image-centre" src="http://staging.stevebob.net/reinventing-the-3d-wheel/similar-triangles-b.png" title="vertical triangle"  alt="vertical triangle"  align="centre"  width="600px" />
</td></tr>
</table>

</div>

<div class="post-body">

<p>Once this formula for converting between 3D and 2D points is implemented, it’s some simple bookkeeping to know which 2D points must be connected to complete the wireframe image. This technique proved suitable for several applications where it wasn’t necessary to ever draw solid polygons or other non-wireframe shapes. Here’s some demos that use it:</p>

<ul>
<li><a href="/three">Three</a></li>

<li><a href="/3dhero">3D Hero</a></li>

<li><a href="/3dtesla">3D Tesla</a></li>

<li><a href="/fractalcubes">Fractal Cubes</a></li>
</ul>

<h2 id="the_proper_way">The “Proper” Way</h2>

<p>In 2012 I took UNSW’s Computer Graphics course with <a href="http://www.cse.unsw.edu.au/~lambert/">Tim Lambert</a>. Each week I would learn something more about how conventional 3D engines work, and I thought it would be neat to build my own 3D engine (entirely in javascript with no video hardware support) and add features as I learnt about them. Here’s how that engine evolved as the course progressed.</p>

<p>This section has several interactive demos of the engine at various stages of completion. To control the eye’s point of view in the demos, use WASD keys to move forwards, left, backwards and right respectively, and the up, down, left and right arrow keys to move up, down, rotate left and rotate right respectively.</p>

<h3 id="perspective_transform">Perspective Transform</h3>

<p>Rather than using a complicated formula to compute the position on screen of a 3D point using perspective projection, one can use matrix multiplication to achieve the same effect. Represent the point (x, y, z) as a vector in R4 (x, y, z, 0) and multiply it by the matrix:</p>

</div>
<div class="post-image-centre-container">

<table class="image-centre">
<caption class="image-caption">Perspective transform matrix
</caption>
<tr><td>
<img class="post-image-centre" src="http://staging.stevebob.net/reinventing-the-3d-wheel/perspective-matrix.png" title="perspective matrix"  alt="perspective matrix"  align="centre"  width="200px" />
</td></tr>
</table>

</div>

<div class="post-body">

<p>This results in a vector in R4 where the first 2 values are the x and y coordinates on the screen to draw that point. The ‘d’ in that matrix refers to the “depth of field”, or “how rapidly points vanish towards the centre of vision”. This image was rendered using a high depth:</p>

</div>
<div class="post-image-centre-container">

<table class="image-centre">
<caption class="image-caption">High depth example
</caption>
<tr><td>
<img class="post-image-centre" src="http://staging.stevebob.net/reinventing-the-3d-wheel/highdepth.png" title="high depth"  alt="high depth"  align="centre"  width="300px" />
</td></tr>
</table>

</div>

<div class="post-body">

<p>This was rendered using a low depth:</p>

</div>
<div class="post-image-centre-container">

<table class="image-centre">
<caption class="image-caption">Low depth example
</caption>
<tr><td>
<img class="post-image-centre" src="http://staging.stevebob.net/reinventing-the-3d-wheel/lowdepth.png" title="low depth"  alt="low depth"  align="centre"  width="300px" />
</td></tr>
</table>

</div>

<div class="post-body">

<p>Here’s a demo that does a perspective transform and nothing else:</p>

<p><a href="/wireframe">Wireframe</a></p>

<h3 id="backface_culling">Back-face Culling</h3>

<p>For this to make sense we need to add faces to our 3D engine. So far all we have been able to draw were points and lines. Now we need to add solid polygons. Think of this as taking a 3D model made from wire and attaching paper cutouts to it. In the real world paper cutouts have a front and a back and are obviously visible from both sides. When our wireframe is completely covered by cutouts, each cutout will have one side (the inside side) which cannot be seen from outside the object.</p>

<p>Having the faces be visible from both sides means more work for the 3D engine. As faces are flat, only one side of the face can be seen at any point, so if we only draw the visible side we generally halve the number of faces we need to consider at any point. This is the idea behind back face culling. Each face is given a front and back face, where the front face faces the outside of the object. With back-face culling, the backs of faces are not drawn.</p>

<p>Here’s a demo of a cube drawn using back-face culling:</p>

<p><a href="/backface-culling">Backface Culling</a></p>

<p>Note that in the simple cube example above it appears that faces are drawn in the “correct” order, in that things in the foreground obscure the things behind them. Back-face culling is sufficient for correct draw order in convex shapes such as cubes, though is insufficient for more complex examples:</p>

<p><a href="/backface-culling-2-cubes">Backface Culling 2 Cubes</a></p>

<h3 id="clipping_plane">Clipping Plane</h3>

<p>Using the similar triangles formula or the matrix multiplication, points behind the eye still get assigned points on the screen. In order to not draw points which are behind the eye, we need a way to remove all these points before rendering. Using a clipping plane to “slice” through the 3D model of the world before rendering is one way to do this. This example places the clipping plane in front of the eye so its effect is more visible. Back-face culling is also in use which can be seen when part of the cube is clipped and the inside is not visible.</p>

<p><a href="/clipping-plane">Clipping Plane</a></p>

<h3 id="binary_space_partitioning">Binary Space Partitioning</h3>

<p>A 3D model is generally represented as a list of polygons, each representing a face. To correctly render the model, the faces must be drawn in a specific order so that things in the foreground cover up the things behind them. Thus we need a way to sort faces into a suitable order such that if they are drawn in that order it looks “correct”. This is not as simple as it may seem, as there may exist mutually overlapping faces, such as the bottom of a cardboard box, where every face is obscured by some other face. Thus we can’t just sort the faces as no face could be drawn last and thus there there may be no order in which we can draw the faces.</p>

<p>The solution is to spit some faces so as to remove all mutually overlapping faces, and sort these faces in the correct order. One algorithm which achieves this is “Binary Space Partitioning”. This involves creating a binary tree of faces known as a Binary Space Partition Tree (BSP Tree), where each face has a front and back side. For each face in this tree, all faces in the right subtree are completely in front of the current face, and all faces in the left subtree are completely behind it. For a face A to be completely in front of or behind some other face B, it means that the plane which contains face B does not intersect face A.</p>

<p>Once this tree is created, faces can be drawn in order by traversing the tree in-order (left subtree, then root, then right subtree). The algorithm for inserting a face into a BSP Tree is as follows:</p>
<pre>
bsp_insert(face, tree):
    if (tree.value == null):
        tree.value = face
    else if (face is entirely in front of tree.value):
        bsp_insert(face, tree.right)
    else if (face is entirely behind tree.value):
        bsp_insert(face, tree.left)
    else:
        face_front = part of face in front of tree.value
        face_behind = part of face behind tree.value
        bsp_insert(face_front, tree.right)
        bsp_insert(face_behind, tree.left)
</pre>
<p>Depending on the order in which faces are added, the number of split faces may vary. It is ideal to minimize the number of splits and thus to reduce the eventual number of faces making it faster to draw them. Generally the list is shuffled and repeatedly inserted into new trees until a reasonably small tree is found. A BSP Tree need only be generated once ever for a given 3D environment, so for games which use BSP Trees, one is pre-compiled when the game is made and the game comes with all its BSP Trees already computed.</p>

<p>A downside of BSP Trees is that they must be regenerated when anything changes in the environment. This makes them not ideal for rendering moveable characters in games.</p>

<p>Here’s a demo showing how a particular 3D environment is split up by the BSP algorithm.</p>

<p><a href="/bsp-wireframe">BSP Wireframe</a></p>

<p>Here’s the same demo with solid faces:</p>

<p><a href="/bsp">BSP Demo</a></p>

<p>And here’s another demo using the same technology to render rooms:</p>

<p><a href="/rooms">Rooms</a></p>

<h2 id="conclusion">Conclusion</h2>

<p>I don’t intend to actually ever use this 3D engine for anything practical. In reality, massively parallel video hardware is used to implement <a href="http://en.wikipedia.org/wiki/Z-buffering">Z-Buffering</a> - a technique which can be used in place of BSP, and libraries exist to remove the need to implement all these low level features. These demos really just served as a learning exercise to myself. Reinventing the wheel is a great way to understand how wheels work.</p>

</div>
</div>



</div>
</div>

<div id="footer">
Copyright &copy; 2014 stevebob.net
</div>
</div>


</body>
</html>
